1)
SELECT man.first_name, COUNT (*)
    FROM employees emp JOIN employees man ON (emp.manager_id = man.employee_id)
GROUP BY man.first_name
    HAVING COUNT (*) > 6;

2)
SELECT d.department_Name, MIN (e.salary-(e.salary*e.comission_pct)/100) min_salary, MAX (e.salary-(e.salary*e.comission_pct)/100) max_salary
FROM departments d join  employees e ON (d.department_id = e.department_id)
GROUP BY d.department_Name

3)
SELECT TOP 1 region_name FROM (
SELECT region_name, COUNT (*) AS [NumberOfPeople]
    FROM employees e
         JOIN departments d ON (e.department_id = d.department_id)
         JOIN locations l ON (d.location_id = l.location_id)
         JOIN countries c ON (l.country_id = c.country_id)
         JOIN regions r ON (c.region_id = r.region_id)
    GROUP BY region_name) p
ORDER BY p.NumberOfPeople DESC

4)
with averagesalaries as (
SELECT department_id, ROUND (AVG (salary)) avg_salary
    FROM employees
GROUP BY department_id
)
SELECT department_id, avg_salary / avg(avg_salary) over ()
from averagesalaries

5)
select distinct first name, last name from (
select department_name, first name, last name, DATEDIFF(year, Start, ISNULL(End, TODAY)) AS [Years in a Department]
from employees e
inner join job_history h
on e.employeeid = h.employeeid
inner join departments d
on e.deparmentid = d.departmentid)
where [Years in a Department]>10

6)
with ranksalaries (
select first name, last name , 
ROW_NUMBER() OVER (ORDER BY Salary desc) AS [Rank]
from employees)
SELECT first name, last name
from ranksalaries 
where [Rank] between 5 and 10
